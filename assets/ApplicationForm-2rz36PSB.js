import{d as ce,a as f,D as ue,aj as me,c as M,o as fe,f as S,i as L,j as z,k as d,n as m,x as o,v as R,l as p,t as s,L as he,q as j,S as ve,U as ge}from"./vue-6PFCaG3D.js";import{P as ye}from"./PageTitle-Daku0jgF.js";import{C as Ce}from"./CopyButton-6lQLrIPa.js";import{u as be,b as Se,e as Te,_ as _e}from"./index-fTqu791Z.js";import{f as Ae}from"./fetchAll-gydFt7zS.js";import{u as Ee,c as De}from"./useMachine-IRD9pAjF.js";import"./kongponents-3HpDyT6r.js";import"./specRenderer-IjoYWasr.js";var O,Ie=new Uint8Array(16);function Me(){if(!O&&(O=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!O))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return O(Ie)}const Le=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Ve(e){return typeof e=="string"&&Le.test(e)}var c=[];for(var W=0;W<256;++W)c.push((W+256).toString(16).substr(1));function Ke(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,u=(c[e[a+0]]+c[e[a+1]]+c[e[a+2]]+c[e[a+3]]+"-"+c[e[a+4]]+c[e[a+5]]+"-"+c[e[a+6]]+c[e[a+7]]+"-"+c[e[a+8]]+c[e[a+9]]+"-"+c[e[a+10]]+c[e[a+11]]+c[e[a+12]]+c[e[a+13]]+c[e[a+14]]+c[e[a+15]]).toLowerCase();if(!Ve(u))throw TypeError("Stringified UUID is invalid");return u}function ke(e,a,u){e=e||{};var h=e.random||(e.rng||Me)();if(h[6]=h[6]&15|64,h[8]=h[8]&63|128,a){u=u||0;for(var A=0;A<16;++A)a[u+A]=h[A];return a}return Ke(h)}function Q(e){const a={};return Object.entries(e).forEach(([u,h])=>{h&&(a[u]=h)}),a}const we=ce({name:"ApplicationForm",components:{PageTitle:ye,CopyButton:Ce},setup(){function e(t){const n={name:"",description:"",redirect_uri:"",reference_id:"",auth_strategy_id:""};return t?delete n.reference_id:delete n.redirect_uri,n}const a=be().state.helpText,u=f(""),h=f(""),A=f(""),G=f(""),$=f(""),V=f(!1),v=f([]),C=f(!1),_=f(null),E=f([]),T=f([]),U=f(!1),K=f(!1),I=f(!0),J=e(C.value),i=f(J),{notify:r}=Te(),k=ue(),X=me(),{state:N,send:D}=Ee(De({predictableActionArguments:!0,id:"applicationFormMachine",initial:"idle",states:{idle:{on:{CLICKED_SUBMIT:"pending",FETCH:"pending",CLICKED_DELETE:"confirm_delete"}},pending:{on:{RESOLVE:"success",REJECT:"error"}},success:{on:{CLICKED_SUBMIT:"pending",CLICKED_DELETE:"confirm_delete"}},error:{on:{CLICKED_SUBMIT:"pending"}},confirm_delete:{on:{CLICKED_DELETE:"pending",CLICKED_CANCEL:"idle"}}}})),Y=M(()=>{var t;return!N.value.matches("pending")&&i.value.name.length&&(F.value!=="edit"?K.value:!0)&&(C.value||((t=i.value.reference_id)==null?void 0:t.length))}),Z=M(()=>{var t;return`Delete ${(t=i.value)==null?void 0:t.name}`}),w=M(()=>k.params.application_id),F=M(()=>w.value?"edit":"create"),x=M(()=>F.value==="create"?oe:ie),ee=M(()=>({edit:N.value.matches("pending")?"Submitting":"Update",create:N.value.matches("pending")?"Submitting":"Create"})[F.value]),{portalApiV2:B}=Se();fe(async()=>{const t=[];w.value?t.push(re()):t.push("_"),I.value=!0,t.push(Ae(n=>B.value.service.applicationsApi.listApplicationAuthStrategies(n)));try{const[n,l]=await Promise.all(t);l.length&&(K.value=!0,v.value=l.map(b=>({label:b.name,value:b.id,isDcr:b.credential_type==="client_credentials",isSelfManaged:b.credential_type==="self_managed_client_credentials",availableScopes:b.credential_type==="client_credentials"&&b.available_scopes?b.available_scopes:void 0,selected:i.value.auth_strategy_id?b.id===i.value.auth_strategy_id:b.id===k.query.auth_strategy_id||!1})));const g=l.length===1,y=g?v.value[0]:v.value.find(b=>b.selected===!0);y&&(g&&(y.selected=!0),i.value.auth_strategy_id=y.value,C.value=y.isDcr,_.value=y,U.value=y.isSelfManaged),I.value=!1}catch(n){I.value=!1,r({appearance:"danger",message:`Error fetching application auth strategies: ${n}`})}});const ae=M(()=>{var t,n;return(t=_.value.availableScopes)!=null&&t.length?(n=_.value.availableScopes)==null?void 0:n.map(l=>{var y;const g=(y=T.value)==null?void 0:y.includes(l);return{label:l,value:l,selected:g}}):[]}),te=(t,n)=>{t(n)||r({appearance:"danger",message:a.copyButton.copyFailed.start+"id"+a.copyButton.copyFailed.end}),r({message:a.copyButton.copySucceeded.start+n+a.copyButton.copySucceeded.end})},ne=t=>{if(!t)return;const n=E.value.includes(t.value);t.selected=!n},le=t=>{const n=v.value.find(l=>l.value===t.value);_.value=n,n&&(i.value.auth_strategy_id=n.value,C.value=n.isDcr,U.value=n.isSelfManaged)},oe=()=>{var t,n;D("CLICKED_SUBMIT"),u.value="",C.value?delete i.value.reference_id:delete i.value.redirect_uri,(t=_.value)!=null&&t.availableScopes?i.value.scopes=(n=E.value)!=null&&n.length?E.value:[]:i.value.scopes=void 0,B.value.service.applicationsApi.createApplication({createApplicationPayload:Q(i.value)}).then(l=>{var g,y;C.value?(V.value=!0,G.value=l.data.id,$.value=l.data.name,A.value=(g=l.data.credentials)==null?void 0:g.client_id,h.value=(y=l.data.credentials)==null?void 0:y.client_secret):P(l.data.id,l.data.name,"created")}).catch(l=>q(l))},ie=()=>{var t,n;D("CLICKED_SUBMIT"),u.value="",(t=_.value)!=null&&t.availableScopes?i.value.scopes=(n=E.value)!=null&&n.length?E.value:[]:i.value.scopes=void 0,delete i.value.auth_strategy_id,B.value.service.applicationsApi.updateApplication({applicationId:w.value,updateApplicationPayload:Q(i.value)}).then(l=>P(l.data.id,l.data.name,"updated")).catch(l=>q(l))},se=()=>{u.value="",B.value.service.applicationsApi.deleteApplication({applicationId:w.value}).then(()=>P("","","deleted")).catch(t=>q(t))},re=async()=>(D("FETCH"),B.value.service.applicationsApi.getApplication({applicationId:w.value}).then(t=>{var l,g;D("RESOLVE");const n={...i.value,name:t.data.name,description:t.data.description||"",redirect_uri:t.data.redirect_uri,reference_id:t.data.reference_id,auth_strategy_id:(l=t.data.auth_strategy)==null?void 0:l.id};(g=t.data.scopes)!=null&&g.length&&(T.value=t.data.scopes),i.value=n}).catch(t=>q(t))),de=()=>{D("CLICKED_CANCEL"),V.value=!1,P(G.value,$.value,"created")},pe=(t,n)=>t?k.query.product&&k.query.product_version?{name:"spec",params:{product:k.query.product,product_version:k.query.product_version},query:{application:n}}:{path:`/application/${t}`}:{path:"/my-apps"},P=(t,n,l)=>{D("RESOLVE"),r({message:`Application successfully ${l}`}),X.push(pe(t,n))},q=t=>{const{data:n}=t.response,l=n.invalid_parameters&&n.invalid_parameters.length&&n.invalid_parameters||n.detail||t.detail;if(D("REJECT"),Array.isArray(l)){u.value=l.map(g=>g.reason).join(", ");return}u.value=l};return{modalTitle:Z,currentState:N,formData:i,errorMessage:u,isEnabled:Y,id:w,clientSecret:h,clientId:A,copyTokenToClipboard:te,fetchingAuthStrategies:I,secretModalIsVisible:V,handleChangedItem:ne,mappedAvailableScopes:ae,selectedScopes:E,handleAcknowledgeSecret:de,hasAppAuthStrategies:K,send:D,buttonText:ee,formMode:F,formMethod:x,handleDelete:se,handleCancel:()=>{X.back()},generateReferenceId:()=>{i.value.reference_id=ke()},helpText:a,appAuthStrategies:v,selectedAuthStrategy:_,onChangeAuthStrategy:le,appIsDcr:C,appIsSelfManaged:U}}}),H=e=>(ve("data-v-379c5b18"),e=e(),ge(),e),Re={class:"w-1/2 mx-auto"},Ue={class:"text-sm mb-5"},Be=H(()=>m("span",{class:"text-danger"},"*",-1)),$e={class:"mb-5"},Ne=H(()=>m("span",{class:"text-danger"},"*",-1)),Fe={class:"mb-5"},Pe=H(()=>m("span",{class:"text-danger"},"*",-1)),qe={key:0,class:"mb-5"},je={key:1,class:"mb-5"},Oe={key:2,class:"mb-5"},He=H(()=>m("span",{class:"text-danger"},"*",-1)),Ge={class:"d-flex"},Je={class:"mb-5"},ze={class:"flex"},We={class:"flex-1"},Xe={key:0};function Qe(e,a,u,h,A,G){const $=S("PageTitle"),V=S("KAlert"),v=S("KLabel"),C=S("KInput"),_=S("KSelect"),E=S("KMultiselect"),T=S("KButton"),U=S("KTextArea"),K=S("KModal"),I=S("CopyButton"),J=S("Content");return L(),z(J,null,{default:d(()=>{var i;return[m("div",Re,[o($,{title:e.$route.meta.title,class:"mb-5"},null,8,["title"]),e.currentState.matches("error")?(L(),z(V,{key:0,appearance:"danger",class:"mb-5","alert-message":e.errorMessage},null,8,["alert-message"])):R("",!0),m("div",null,[m("p",Ue,[Be,p(" "+s(e.helpText.application.reqField),1)]),!e.hasAppAuthStrategies&&!e.fetchingAuthStrategies&&e.formMode==="create"?(L(),z(V,{key:0,"alert-message":e.helpText.application.authStrategyWarning,appearance:"warning",class:"no-auth-strategies-warning","data-testid":"no-auth-strategies-warning"},null,8,["alert-message"])):R("",!0),m("form",{onSubmit:a[6]||(a[6]=he((...r)=>e.formMethod&&e.formMethod(...r),["prevent"]))},[m("div",$e,[o(v,{for:"applicationName"},{default:d(()=>[p(s(e.helpText.application.applicationName)+" ",1),Ne]),_:1}),o(C,{id:"applicationName",modelValue:e.formData.name,"onUpdate:modelValue":a[0]||(a[0]=r=>e.formData.name=r),modelModifiers:{trim:!0},"data-testid":"application-name-input",type:"text",class:"k-input--full"},null,8,["modelValue"])]),m("div",Fe,[o(v,{for:"authStrat"},{default:d(()=>[p(s(e.helpText.application.authStrategy)+" ",1),Pe]),_:1}),o(_,{id:"authStrat",items:e.appAuthStrategies,disabled:e.formMode==="edit"||e.appAuthStrategies.length===1,"data-testid":"application-auth-strategy-select",appearance:"select",width:"100%",onChange:e.onChangeAuthStrategy},null,8,["items","disabled","onChange"])]),(i=e.selectedAuthStrategy)!=null&&i.availableScopes?(L(),j("div",qe,[o(v,{for:"availableScopes"},{default:d(()=>[p(s(e.helpText.application.availableScopes),1)]),_:1}),o(E,{id:"availableScopes",modelValue:e.selectedScopes,"onUpdate:modelValue":a[1]||(a[1]=r=>e.selectedScopes=r),"collapsed-context":"","data-testid":"available-scopes-select",class:"available-scopes-select",items:e.mappedAvailableScopes,placeholder:e.helpText.application.filterScopesPlaceholder,width:"100%",onChange:e.handleChangedItem},null,8,["modelValue","items","placeholder","onChange"])])):R("",!0),e.appIsDcr||e.appIsSelfManaged?(L(),j("div",je,[o(v,{for:"redirectUri"},{default:d(()=>[p(s(e.helpText.application.redirectUriLabel),1)]),_:1}),o(C,{id:"redirectUri",modelValue:e.formData.redirect_uri,"onUpdate:modelValue":a[2]||(a[2]=r=>e.formData.redirect_uri=r),type:"text",class:"w-100 k-input--full"},null,8,["modelValue"])])):R("",!0),e.appIsDcr?R("",!0):(L(),j("div",Oe,[o(v,{for:"referenceId"},{default:d(()=>[p(s(e.helpText.application.form.referenceId.label)+" ",1),He]),_:1}),m("div",Ge,[o(C,{id:"referenceId",modelValue:e.formData.reference_id,"onUpdate:modelValue":a[3]||(a[3]=r=>e.formData.reference_id=r),"data-testid":"reference-id-input",type:"text",class:"k-input--full",placeholder:e.helpText.application.form.referenceId.placeholder,help:e.helpText.application.form.referenceId.help},null,8,["modelValue","placeholder","help"]),o(T,{class:"generate-reference-id-button","data-testid":"generate-reference-id","is-rounded":!1,appearance:"secondary",size:"small",onClick:e.generateReferenceId},{default:d(()=>[p(s(e.helpText.application.form.referenceId.generate),1)]),_:1},8,["onClick"])])])),m("div",Je,[o(v,{for:"description"},{default:d(()=>[p(s(e.helpText.application.description),1)]),_:1}),o(U,{id:"description",modelValue:e.formData.description,"onUpdate:modelValue":a[4]||(a[4]=r=>e.formData.description=r),modelModifiers:{trim:!0},rows:5,class:"k-input--full"},null,8,["modelValue"])]),m("div",ze,[m("div",We,[o(T,{"is-rounded":!1,type:"submit",appearance:"primary",class:"mr-4",disabled:e.isEnabled?null:!0},{default:d(()=>[p(s(e.buttonText),1)]),_:1},8,["disabled"]),o(T,{"is-rounded":!1,appearance:"secondary",onClick:e.handleCancel},{default:d(()=>[p(s(e.helpText.application.cancel),1)]),_:1},8,["onClick"])]),e.formMode==="edit"?(L(),j("div",Xe,[o(T,{"data-testid":"application-delete-button",appearance:"danger","is-rounded":!1,onClick:a[5]||(a[5]=r=>e.send("CLICKED_DELETE"))},{default:d(()=>[p(s(e.helpText.application.delete),1)]),_:1})])):R("",!0)])],32)])]),o(K,{title:e.modalTitle,"is-visible":e.currentState.matches("confirm_delete"),"data-testid":"application-delete-modal","action-button-text":e.helpText.application.delete,"action-button-appearance":"danger",class:"delete-modal",onCanceled:a[8]||(a[8]=r=>e.send("CLICKED_CANCEL"))},{"header-content":d(()=>[p(s(e.modalTitle),1)]),"body-content":d(()=>[p(s(e.helpText.application.confirmDelete(e.formData.name)),1)]),"footer-content":d(()=>[o(T,{"is-rounded":!1,appearance:"danger","data-testid":"application-delete-confirm-button",class:"mr-3",onClick:e.handleDelete},{default:d(()=>[p(s(e.helpText.application.delete),1)]),_:1},8,["onClick"]),o(T,{appearance:"secondary","is-rounded":!1,"data-testid":"application-delete-cancel-button",onClick:a[7]||(a[7]=r=>e.send("CLICKED_CANCEL"))},{default:d(()=>[p(s(e.helpText.application.cancel),1)]),_:1})]),_:1},8,["title","is-visible","action-button-text"]),o(K,{title:e.helpText.application.applicationCredentials,"is-visible":e.secretModalIsVisible,"data-testid":"copy-secret-modal","action-button-text":e.helpText.application.delete,"action-button-appearance":"danger",class:"application-secret-modal",onCanceled:a[9]||(a[9]=r=>e.send("CLICKED_CANCEL"))},{"header-content":d(()=>[p(s(e.helpText.application.applicationSecret),1)]),"body-content":d(()=>[p(s(e.helpText.application.headerDescription1),1),m("strong",null,s(e.formData.name),1),p(" "+s(e.helpText.application.headerDescription2),1),m("strong",null,s(e.helpText.application.headerDescription3),1),p(" "+s(e.helpText.application.headerDescription4)+" ",1),o(I,{label:e.helpText.application.clientID,"text-to-copy":e.clientId},null,8,["label","text-to-copy"]),o(I,{label:e.helpText.application.clientSecret,"text-to-copy":e.clientSecret},null,8,["label","text-to-copy"])]),"footer-content":d(()=>[o(T,{"is-rounded":!1,appearance:"primary","data-testid":"close-application-secret-modal",onClick:e.handleAcknowledgeSecret},{default:d(()=>[p(s(e.helpText.application.proceed),1)]),_:1},8,["onClick"])]),_:1},8,["title","is-visible","action-button-text"])]}),_:1})}const sa=_e(we,[["render",Qe],["__scopeId","data-v-379c5b18"]]);export{sa as default};
