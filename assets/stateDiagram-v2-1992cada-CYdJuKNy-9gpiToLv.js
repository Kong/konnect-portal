import{D as U,v as I,A as F,E as M,t as H,I as Q,_ as X,C as Z}from"./styles-0784dbeb-CF_E7fxi-ZO9nWBau.js";import{Y as tt}from"./graph-X3AqOr2l-O4Bz9U1Q.js";import{l as p,c as S,h as A,z as et,i as st,j as B}from"./ApiDocumentationPage-tl1euDJv.js";import{b as ot}from"./index-01f381cb-D6ERtkQO-GudaHd95.js";import"./layout-rkXrpYy--kbfey5Si.js";import"./vue-6PFCaG3D.js";import"./index-fTqu791Z.js";import"./kongponents-3HpDyT6r.js";import"./specRenderer-IjoYWasr.js";import"./getMessageFromError-KCSW6jpt.js";import"./document-l6RdaXdg.js";import"./feature-flags-cof9wo1L.js";import"./clone-Cei040DH-pe1MkJGD.js";import"./edges-066a5561-BVE6Q1zS-TYeeDYW2.js";import"./createText-ca0c5216-DrKH6pb2-Gi9d5MY_.js";import"./line-CN4DfsoG-XWyKGnTp.js";import"./array-CqVTtuYm-kXEfrAop.js";import"./path-DLwuMfdd-LN2vUMWq.js";const w="rect",k="rectWithTitle",it="start",rt="end",at="divider",nt="roundedWithTitle",dt="note",lt="noteGroup",m="statediagram",ct="state",pt=`${m}-${ct}`,j="transition",gt="note",bt="note-edge",ht=`${j} ${bt}`,mt=`${m}-${gt}`,ut="cluster",yt=`${m}-${ut}`,ft="cluster-alt",$t=`${m}-${ft}`,O="parent",P="note",xt="state",E="----",wt=`${E}${P}`,L=`${E}${O}`,W="fill:none",G="fill: #333",Y="c",q="text",J="normal";let T={},c=0;const Tt=function(t){const i=Object.keys(t);for(const e of i)t[e]},St=function(t,i){return i.db.extract(i.db.getRootDocV2()),i.db.getClasses()};function Dt(t){return t==null?"":t.classes?t.classes.join(" "):""}function v(t="",i=0,e="",r=E){const a=e!==null&&e.length>0?`${r}${e}`:"";return`${xt}-${t}${a}-${i}`}const x=(t,i,e,r,a,n)=>{const s=e.id,u=Dt(r[s]);if(s!=="root"){let b=w;e.start===!0&&(b=it),e.start===!1&&(b=rt),e.type!==M&&(b=e.type),T[s]||(T[s]={id:s,shape:b,description:B.sanitizeText(s,S()),classes:`${u} ${pt}`});const o=T[s];e.description&&(Array.isArray(o.description)?(o.shape=k,o.description.push(e.description)):o.description.length>0?(o.shape=k,o.description===s?o.description=[e.description]:o.description=[o.description,e.description]):(o.shape=w,o.description=e.description),o.description=B.sanitizeTextOrArray(o.description,S())),o.description.length===1&&o.shape===k&&(o.shape=w),!o.type&&e.doc&&(p.info("Setting cluster for ",s,C(e)),o.type="group",o.dir=C(e),o.shape=e.type===H?at:nt,o.classes=o.classes+" "+yt+" "+(n?$t:""));const h={labelStyle:"",shape:o.shape,labelText:o.description,classes:o.classes,style:"",id:s,dir:o.dir,domId:v(s,c),type:o.type,padding:15};if(h.centerLabel=!0,e.note){const d={labelStyle:"",shape:dt,labelText:e.note.text,classes:mt,style:"",id:s+wt+"-"+c,domId:v(s,c,P),type:o.type,padding:15},l={labelStyle:"",shape:lt,labelText:e.note.text,classes:o.classes,style:"",id:s+L,domId:v(s,c,O),type:"group",padding:0};c++;const y=s+L;t.setNode(y,l),t.setNode(d.id,d),t.setNode(s,h),t.setParent(s,y),t.setParent(d.id,y);let g=s,f=d.id;e.note.position==="left of"&&(g=d.id,f=s),t.setEdge(g,f,{arrowhead:"none",arrowType:"",style:W,labelStyle:"",classes:ht,arrowheadStyle:G,labelpos:Y,labelType:q,thickness:J})}else t.setNode(s,h)}i&&i.id!=="root"&&(p.trace("Setting node ",s," to be child of its parent ",i.id),t.setParent(s,i.id)),e.doc&&(p.trace("Adding nodes children "),At(t,e,e.doc,r,a,!n))},At=(t,i,e,r,a,n)=>{p.trace("items",e),e.forEach(s=>{switch(s.stmt){case X:x(t,i,s,r,a,n);break;case M:x(t,i,s,r,a,n);break;case Q:{x(t,i,s.state1,r,a,n),x(t,i,s.state2,r,a,n);const u={id:"edge"+c,arrowhead:"normal",arrowTypeEnd:"arrow_barb",style:W,labelStyle:"",label:B.sanitizeText(s.description,S()),arrowheadStyle:G,labelpos:Y,labelType:q,thickness:J,classes:j};t.setEdge(s.state1.id,s.state2.id,u,c),c++}break}})},C=(t,i=Z)=>{let e=i;if(t.doc)for(let r=0;r<t.doc.length;r++){const a=t.doc[r];a.stmt==="dir"&&(e=a.value)}return e},kt=async function(t,i,e,r){p.info("Drawing state diagram (v2)",i),T={},r.db.getDirection();const{securityLevel:a,state:n}=S(),s=n.nodeSpacing||50,u=n.rankSpacing||50;p.info(r.db.getRootDocV2()),r.db.extract(r.db.getRootDocV2()),p.info(r.db.getRootDocV2());const b=r.db.getStates(),o=new tt({multigraph:!0,compound:!0}).setGraph({rankdir:C(r.db.getRootDocV2()),nodesep:s,ranksep:u,marginx:8,marginy:8}).setDefaultEdgeLabel(function(){return{}});x(o,void 0,r.db.getRootDocV2(),b,r.db,!0);let h;a==="sandbox"&&(h=A("#i"+i));const d=a==="sandbox"?A(h.nodes()[0].contentDocument.body):A("body"),l=d.select(`[id="${i}"]`),y=d.select("#"+i+" g");await ot(y,o,["barb"],m,i);const g=8;et.insertTitle(l,"statediagramTitleText",n.titleTopMargin,r.db.getDiagramTitle());const f=l.node().getBBox(),R=f.width+g*2,V=f.height+g*2;l.attr("class",m);const z=l.node().getBBox();st(l,V,R,n.useMaxWidth);const N=`${z.x-g} ${z.y-g} ${R} ${V}`;p.debug(`viewBox ${N}`),l.attr("viewBox",N);const K=document.querySelectorAll('[id="'+i+'"] .edgeLabel .label');for(const D of K){const _=D.getBBox(),$=document.createElementNS("http://www.w3.org/2000/svg",w);$.setAttribute("rx",0),$.setAttribute("ry",0),$.setAttribute("width",_.width),$.setAttribute("height",_.height),D.insertBefore($,D.firstChild)}},vt={setConf:Tt,getClasses:St,draw:kt},Jt={parser:U,db:I,renderer:vt,styles:F,init:t=>{t.state||(t.state={}),t.state.arrowMarkerAbsolute=t.arrowMarkerAbsolute,I.clear()}};export{Jt as diagram};
