import{g as _}from"./getMessageFromError-KCSW6jpt.js";import{A as x,R as ee}from"./ActionsDropdown-rXNugXab.js";import{P as te}from"./PageTitle-Daku0jgF.js";import{k as ae,_ as ne,Y as se,D as oe,Q as re,v as q}from"./vitals-config-store.es-LcW54xbW.js";import{b as ie,u as J,e as le,d as pe,_ as de}from"./index-fTqu791Z.js";import{u as ce,c as ue}from"./useMachine-IRD9pAjF.js";import{d as he,a as i,c as M,o as me,f as o,i as g,j as P,k as a,x as s,q as z,n as c,t as r,l as f,v as w,al as ge,am as fe,S as ye,U as ve}from"./vue-6PFCaG3D.js";import"./CopyButton-6lQLrIPa.js";import"./specRenderer-IjoYWasr.js";import"./kongponents-3HpDyT6r.js";const Se=he({name:"MyApps",components:{AnalyticsConfigCheck:ae,PageTitle:te,ActionsDropdown:x,RefreshTokenModal:ee,MetricsProvider:ne,MetricsConsumer:se},setup(){const{notify:e}=le(),l=i(""),R=i(""),F=i([]),$=i(0),N=M(()=>$.value.toString()),d=i(null),T=i(null),y=i(null),k=i(!1),v=i(null),{portalApiV2:S}=ie(),b=i(!1),C=i(!0),u=J().state.helpText.myApp,h=J().state.helpText.analytics,I=i({paginationPageSizes:[25,50,100],initialPageSize:25}),V=n=>{var p;return((p=n.auth_strategy)==null?void 0:p.credential_type)===pe.CredentialType.ClientCredentials},K=M(()=>{var n;return`Delete ${(n=d.value)==null?void 0:n.name}`}),A=i(null),{state:H,send:t}=ce(ue({predictableActionArguments:!0,id:"DeveloperMachine",initial:"idle",states:{idle:{on:{FETCH:"pending",REJECT:"error"}},pending:{on:{RESOLVE:"success",REJECT:"error"}},success:{on:{FETCH:"pending"}},error:{on:{FETCH:"pending"}}}})),m=()=>{$.value+=1},L=async n=>{const{pageSize:p,page:D}=n,X={pageNumber:D,pageSize:p,...R.value.length&&{filterNameContains:R.value}};return t("FETCH"),S.value.service.applicationsApi.listApplications(X).then(E=>(t("RESOLVE"),A.value=E.data.data.map(Z=>Z.id),{data:E.data.data,total:E.data.meta.page.total})).catch(E=>{t("REJECT"),l.value=_(E)})},O=()=>{t("FETCH"),S.value.service.applicationsApi.deleteApplication({applicationId:d.value.id}).then(()=>{t("RESOLVE"),d.value=null,T.value=null,m(),e({message:u.deleteSuccess})}).catch(n=>{t("REJECT"),d.value=null,T.value=u.deleteFailure(_(n))})},Y=n=>{t("FETCH"),y.value=null,S.value.service.credentialsApi.refreshApplicationToken({applicationId:n}).then(p=>{e({message:u.refreshSecretSuccess}),k.value=!0,v.value=p.data.client_secret}).catch(p=>{t("REJECT"),y.value=u.refreshSecretFailure(_(p))})},U=()=>{k.value=!1,v.value=null},j=[{label:"Name",key:"name"},{label:"Description",key:"description"},{hideLabel:!0,key:"actions"}],Q=n=>n.key===q.ONE_DAY?`${h.summary24Hours} ${h.summary}`:n.key===q.THIRTY_DAY?`${h.summary30Days} ${h.summary}`:h.summary,W=M(()=>A.value!==null),B=M(()=>{var n;return!!((n=A.value)!=null&&n.length)}),G=M(()=>({queryReady:B.value,additionalFilter:[{type:oe.IN,dimension:re.APPLICATION,values:A.value}]}));return me(async()=>{var n,p;C.value=!0;try{(p=(n=(await S.value.service.applicationsApi.listApplicationAuthStrategies()).data)==null?void 0:n.data)!=null&&p.length&&(b.value=!0),C.value=!1}catch(D){C.value=!1,e({appearance:"danger",message:u.authStrategyFetchError(_(D))})}}),{modalTitle:K,errorMessage:l,applications:F,currentState:H,tableHeaders:j,handleDelete:O,fetchingAuthStrategies:C,isApplicationDcr:V,deleteItem:d,deleteError:T,showSecretModal:k,hasAppAuthStrategies:b,token:v,onModalClose:U,handleRefreshSecret:Y,refreshSecretError:y,searchStr:R,fetcherCacheKey:N,fetcher:L,paginationConfig:I,helpText:u,helpTextVitals:h,analyticsCardTitle:Q,metricProviderProps:G,myAppsReady:W,appsArePresent:B}}}),Ce=e=>(ye("data-v-7fec319c"),e=e(),ve(),e),Ae={width:"16",height:"16",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"mr-2"},Te=Ce(()=>c("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M16 8A8 8 0 110 8a8 8 0 0116 0zM7 5a1 1 0 012 0v2h2a1 1 0 110 2H9v2a1 1 0 11-2 0V9H5a1 1 0 110-2h2V5z",fill:"#fff","fill-opacity":".75"},null,-1)),ke={class:"summary-tier-based mb-4"},be={class:"applications-toolbar"},Ee=["onClick"],Me=["onClick"],Pe=["onClick"],we={key:0};function Re(e,l,R,F,$,N){const d=o("KButton"),T=o("PageTitle"),y=o("KAlert"),k=o("MetricsConsumer"),v=o("KCard"),S=o("MetricsProvider"),b=o("AnalyticsConfigCheck"),C=o("KInput"),u=o("ActionsDropdown"),h=o("router-link"),I=o("EmptyState"),V=o("KTable"),K=o("KModal"),A=o("RefreshTokenModal"),H=o("Content");return g(),P(H,null,{default:a(()=>[s(T,{title:e.helpText.myApps,class:"mb-6"},{right:a(()=>[s(d,{"data-testid":"create-application-button",appearance:"primary",disabled:!e.hasAppAuthStrategies,"is-rounded":!1,to:{name:"create-application"}},{default:a(()=>[(g(),z("svg",Ae,[c("title",null,r(e.helpText.plus),1),Te])),f(" "+r(e.helpText.newApp),1)]),_:1},8,["disabled"])]),_:1},8,["title"]),!e.hasAppAuthStrategies&&!e.fetchingAuthStrategies?(g(),P(y,{key:0,"alert-message":e.helpText.authStrategyWarning,appearance:"warning",class:"no-auth-strategies-warning","data-testid":"no-auth-strategies-warning"},null,8,["alert-message"])):w("",!0),!e.myAppsReady||e.appsArePresent?(g(),P(b,{key:1,"require-analytics":""},{default:a(()=>[c("div",null,[s(S,ge(fe(e.metricProviderProps)),{default:a(({timeframe:t})=>[c("h2",ke,r(e.analyticsCardTitle(t)),1),s(v,{class:"mb-4 analytics-my-apps","data-testid":"analytics-metric-cards"},{body:a(()=>[s(k)]),_:1})]),_:1},16)])]),_:1})):w("",!0),c("div",null,[s(y,{"is-showing":!!e.deleteError,title:e.deleteError,appearance:"danger","data-testid":"delete-error-alert"},null,8,["is-showing","title"]),s(y,{"is-showing":!!e.refreshSecretError,title:e.refreshSecretError,appearance:"danger","data-testid":"refresh-error-alert"},null,8,["is-showing","title"]),s(v,null,{body:a(()=>[s(V,{"data-testid":"applications-table","fetcher-cache-key":e.fetcherCacheKey,fetcher:e.fetcher,"has-side-border":"","has-error":e.currentState.matches("error")&&!e.deleteError&&!e.refreshSecretError,"is-loading":e.currentState.matches("pending"),headers:e.tableHeaders,"is-clickable":"","is-small":"",class:"applications-table","pagination-page-sizes":e.paginationConfig.paginationPageSizes,"search-input":e.searchStr,"initial-fetcher-params":{pageSize:e.paginationConfig.initialPageSize},"onRow:click":l[1]||(l[1]=(t,m)=>e.$router.push({name:"show-application",params:{application_id:m.id}}))},{toolbar:a(({state:t})=>[c("div",be,[t.hasData||e.searchStr?(g(),P(C,{key:0,modelValue:e.searchStr,"onUpdate:modelValue":l[0]||(l[0]=m=>e.searchStr=m),placeholder:e.helpText.searchPlaceholder,type:"search"},null,8,["modelValue","placeholder"])):w("",!0)])]),name:a(({row:t})=>[f(r(t.name),1)]),actions:a(({row:t})=>[(g(),P(u,{key:t.id,"data-testid":"actions-dropdown-"+t.id},{content:a(()=>[s(b,{"require-analytics":""},{default:a(()=>[c("div",{"data-testid":"dropdown-analytics-dashboard",class:"py-2 px-3 type-md cursor-pointer",onClick:m=>e.$router.push({name:"application-dashboard",params:{application_id:t.id}})},r(e.helpTextVitals.viewAnalytics),9,Ee)]),_:2},1024),e.isApplicationDcr(t)?(g(),z("div",{key:0,"data-testid":"dropdown-refresh-application-dcr-token",class:"py-2 px-3 type-md cursor-pointer",onClick:m=>e.handleRefreshSecret(t.id)},r(e.helpText.refreshSecret),9,Me)):w("",!0),c("div",{"data-testid":"dropdown-delete-application",class:"py-2 px-3 type-md cursor-pointer delete-item",onClick:m=>e.deleteItem=t},r(e.helpText.delete),9,Pe)]),_:2},1032,["data-testid"]))]),"empty-state":a(()=>[s(I,{title:e.searchStr?e.helpText.noSearchResults:e.helpText.noApp},{message:a(()=>[e.hasAppAuthStrategies?(g(),z("p",we,[s(h,{"data-testid":"create-application-link",to:{name:"create-application"}},{default:a(()=>[f(r(e.helpText.create),1)]),_:1}),f(" "+r(e.helpText.getStarted),1)])):w("",!0)]),_:1},8,["title"])]),"error-state":a(()=>[s(I,{"is-error":"",title:e.helpText.noApp},{message:a(()=>[c("p",null,r("Error: "+e.errorMessage),1)]),_:1},8,["title"])]),_:1},8,["fetcher-cache-key","fetcher","has-error","is-loading","headers","pagination-page-sizes","search-input","initial-fetcher-params"])]),_:1})]),s(K,{title:e.modalTitle,"is-visible":!!e.deleteItem,"action-button-text":e.helpText.delete,"action-button-appearance":"danger",class:"delete-modal","data-testid":"application-delete-modal",onCanceled:l[3]||(l[3]=t=>e.deleteItem=null)},{"header-content":a(()=>[f(r(e.modalTitle),1)]),"body-content":a(()=>[f(r(e.helpText.deleteDialog(e.deleteItem.name)),1)]),"footer-content":a(()=>[s(d,{appearance:"danger","data-testid":"application-delete-confirm-button",disabled:e.currentState.matches("pending"),icon:e.currentState.matches("pending")?"spinner":void 0,"is-rounded":!1,class:"mr-3",onClick:e.handleDelete},{default:a(()=>[f(r(e.helpText.delete),1)]),_:1},8,["disabled","icon","onClick"]),s(d,{appearance:"secondary","is-rounded":!1,onClick:l[2]||(l[2]=t=>e.deleteItem=null)},{default:a(()=>[f(r(e.helpText.cancel),1)]),_:1})]),_:1},8,["title","is-visible","action-button-text"]),s(A,{"is-visible":e.showSecretModal,token:e.token,onClosed:e.onModalClose},null,8,["is-visible","token","onClosed"])]),_:1})}const Be=de(Se,[["render",Re],["__scopeId","data-v-7fec319c"]]);export{Be as default};
